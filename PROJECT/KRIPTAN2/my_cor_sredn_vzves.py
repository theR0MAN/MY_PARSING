# для каждого графика выведем среднюю общую согласно весовым кэфам, за которые примем коэф корреляции.
from PROJECT.TEST.Test_lib import *
from PROJECT.VIZUAL.Viz_lib import get_color
from PROJECT.SCIENTIC.sc_sredn_lib import *
from platform import system
import plotly.express as px
from collections import deque
import datetime, time  # timer=time.time()
import traceback
import statistics
import pandas as pd
from PROJECT.SBOR.my_lib import *
# from IPython.display import display

zadpol=3
zadtmsmp=2

pth='G:\\NEWKRIPT'

# markets = os.listdir(pth)
markets = ['binance&swap', ]  #'poloniex',24 1  7-10
print(markets)

# markets = ['FRTS2']  # ,'MOEX'
instdict = dict()

minutki = 123
onlymerge = 0

hardsync=False
# hardsync True - жесткая синхронизация, когда все инструменты одновременно вписываются в задержки
# hardsync False - просто когда присутствуют все инструменры
start_year, start_month, start_day, start_hour = 2024, 3, 23, 1
stop_year, stop_month, stop_day, stop_hour = 2024, 3, 23, 10

content = getdata_merge(onlymerge, minutki, markets, pth, start_year, start_month, start_day, start_hour, stop_year,
						stop_month, stop_day, stop_hour)
print(content)

if content==[]:
	print(' нет данных за этот период' )
	quit()

exem = Getl2(content, 200, 0.95, 10)
# scie = Mysredn()
z = exem.get_l2NEW()  # получает словарь котиров
day0 = -1
count = 0
ct = 0

razrez = 0
countrr = 0

obryv = dict()
paintdict = {}
# подготовка словаря отрисовки
ixes = []


first=False
instset=set()

data = next(z)
# готовим итоговый массив
rezdict = dict()
cordat = dict()
cordatsum = dict()
for sym in data:
	cordat[sym]=[]
	cordatsum[sym]=0

	rezdict[sym] = dict()
	rezdict[sym]['asks'] = []
	rezdict[sym]['bids'] = []
kcnt=0

easy=False


print(' START WHILE')
while True:

	try:
		# timer=time.time()
		data = next(z)  # это якобы на серваке - к нему нужен доступ


		timestamps=[]
		medtmamp =0
		for inst in data:
			if data[inst]['dat'] != None:
				tmst=data[inst]['dat']['timestamp']
				timestamps.append(tmst)
		if timestamps!=[]:
			medtmamp=statistics.median(timestamps)



		wrt=True
		if  not easy:
			if hardsync:
				for inst in data:
					if data [inst]['dat'] != None:
						if not (data [inst]['tmstp'][1]<zadpol and medtmamp-data [inst]['dat']['timestamp']<zadtmsmp):
							wrt = False
					else:
						wrt= False
			else:
				for inst in data:
					if data [inst]['dat'] == None:
						wrt = False


		if wrt:
			if not hardsync: # чтобы избежать лишних итераций далее
				easy=True

			for inst in data:
				rezdict[inst]['asks'].append(data[inst]['dat']['asks'][0])
				rezdict[inst]['bids'].append(data[inst]['dat']['bids'][0])
				cordat[inst].append((data[inst]['dat']['asks'][0]+data[inst]['dat']['bids'][0])/2)


			ixes.append(count)
			count += 1

	except Exception:
		print(traceback.format_exc())
		print('error')
		# quit()
		break

print('нормализация словаря')

timer = time.time()
for  inst in rezdict :
	sm=0
	cnt=0
	ind=-1
	for ask in rezdict  [inst]['asks']:
		ind+=1
		if ask != None :
			bid=rezdict  [inst]['bids'][ind]
			sm+=(ask+bid)/2
			cnt+=1
	if cnt !=0:
		sredn =sm/cnt
		ind = -1
		for ask in rezdict  [inst]['asks']:
			ind += 1
			if ask != None:
				rezdict  [inst]['bids'][ind]=100*rezdict  [inst]['bids'][ind]/ sredn
				rezdict  [inst]['asks'][ind] = 100 * rezdict  [inst]['asks'][ind] / sredn
				cordat[inst][ind]=((rezdict[inst]['bids'][ind] + rezdict[inst]['asks'][ind])/2)

print('skorost =',time.time()-timer)

print('распилим на снапшоты')
ixes2=[]
cordat2=dict()

firstkey= next(iter(cordat))
ln=len(cordat[firstkey])

for inst in cordat:
	cordat2[inst]=cordat[inst][0:ln:20]

firstkey= next(iter(cordat2))
ln=len(cordat2[firstkey])
for i in range(ln):
	ixes2.append(i)

print('добавка сумм движений')
for inst in cordat2:
	for i in range(len(cordat2[inst])):
		if i>0:
			cordatsum[inst] += abs(cordat2[inst][i] - cordat2[inst][i - 1])

# YGG/USDT:USDT*binance&swap [['YGG/USDT:USDT*binance&swap', 1.0, 38.97591060800528], ['LOOM/USDT:USDT*binance&swap', 0.9931556213987282, 33.0323768530651], ['OGN/USDT:USDT*binance&swap', 0.9931022296715889, 41.19132583684039], ['RSR/USDT:USDT*binance&swap', 0.9928403935716414, 37.93892197064872], ['BAND/USDT:USDT*binance&swap', 0.9926162109879698, 33.68438130584241], ['BICO/USDT:USDT*binance&swap', 0.9924378255742422, 37.69040753794317], ['BNT/USDT:USDT*binance&swap', 0.9924322810340163, 33.23515550766477], ['REN/USDT:USDT*binance&swap', 0.9921728480287484, 37.472097171074466], ['ORBS/USDT:USDT*binance&swap', 0.9920299904625897, 34.61010805513831], ['ALPHA/USDT:USDT*binance&swap', 0.9919775712847293, 35.311656853137904], ['REEF/USDT:USDT*binance&swap', 0.9919592656441792, 40.26904805007109], ['STG/USDT:USDT*binance&swap', 0.9918821245409878, 28.20066691585035], ['BAL/USDT:USDT*binance&swap', 0.9917708844615918, 30.533468495057704], ['ALGO/USDT:USDT*binance&swap', 0.991629921272564, 33.88428294722911], ['FLOW/USDT:USDT*binance&swap', 0.9916179096930396, 34.92608988546637], ['LPT/USDT:USDT*binance&swap', 0.9915857067311034, 47.320888057464146], ['AXS/USDT:USDT*binance&swap', 0.9915606775125102, 37.17891950252985], ['SUSHI/USDT:USDT*binance&swap', 0.9914907850788265, 35.575835170675944], ['AUDIO/USDT:USDT*binance&swap', 0.9913280987781222, 35.004830052011314], ['UMA/USDT:USDT*binance&swap', 0.9911389639523024, 40.01999932470052], ['AGLD/USDT:USDT*binance&swap', 0.9911286682104441, 35.27356189869231], ['NMR/USDT:USDT*binance&swap', 0.991084693133369, 37.56068149547241], ['ENJ/USDT:USDT*binance&swap', 0.9909878168029023, 38.832009902955264], ['ACE/USDT:USDT*binance&swap', 0.9909259367969042, 41.465234330359934], ['DASH/USDT:USDT*binance&swap', 0.9909028498477714, 32.45676363561712], ['KSM/USDT:USDT*binance&swap', 0.9908709796587828, 40.72087725720502], ['TLM/USDT:USDT*binance&swap', 0.9904859151073245, 38.16117478733102], ['LSK/USDT:USDT*binance&swap', 0.990467838574839, 34.80252926311334], ['RDNT/USDT:USDT*binance&swap', 0.9904473925828413, 34.63128948017797], ['KLAY/USDT:USDT*binance&swap', 0.9904008750609876, 31.49674697109083], ['MINA/USDT:USDT*binance&swap', 0.9903560513003291, 34.63478578879335], ['ALICE/USDT:USDT*binance&swap', 0.9902700710892549, 41.51565632263663], ['LINK/USDT:USDT*binance&swap', 0.990114156126628, 31.697947317320256], ['WOO/USDT:USDT*binance&swap', 0.990100713958475, 38.468937224196964], ['CTSI/USDT:USDT*binance&swap', 0.9900715750043285, 40.052146436747506], ['IOTX/USDT:USDT*binance&swap', 0.9899976682762871, 36.1070743227572], ['COMP/USDT:USDT*binance&swap', 0.9899619429948109, 35.64721237813029], ['BIGTIME/USDT:USDT*binance&swap', 0.9896849422966408, 46.3624855474154], ['DOT/USDT:USDT*binance&swap', 0.9896627778967402, 35.523683575742126], ['CHZ/USDT:USDT*binance&swap', 0.9896303225219222, 31.75284211786243], ['MDT/USDT:USDT*binance&swap', 0.9894503690584607, 38.25796832968136], ['AUCTION/USDT:USDT*binance&swap', 0.9894320092803581, 36.29028340922605], ['ANKR/USDT:USDT*binance&swap', 0.9893507936711031, 34.73970413445127], ['ARPA/USDT:USDT*binance&swap', 0.9891411416577119, 34.505626916649646], ['ICX/USDT:USDT*binance&swap', 0.989077679374983, 33.573818434066894], ['MAGIC/USDT:USDT*binance&swap', 0.9889286922836771, 37.667498267007446], ['KNC/USDT:USDT*binance&swap', 0.9889037505358274, 34.90153892738144], ['TRB/USDT:USDT*binance&swap', 0.9888311590938987, 36.106849896394465], ['EGLD/USDT:USDT*binance&swap', 0.9888149341844427, 36.60486897945323], ['SNX/USDT:USDT*binance&swap', 0.9887928706392886, 31.509245222313183], ['PERP/USDT:USDT*binance&swap', 0.9887446915215862, 36.943498800641535], ['T/USDT:USDT*binance&swap', 0.9887371800342476, 32.99232859540601], ['ONT/USDT:USDT*binance&swap', 0.9885907693502731, 34.10771104143768], ['POWR/USDT:USDT*binance&swap', 0.9884107761617282, 33.87216483899911], ['QNT/USDT:USDT*binance&swap', 0.9883121756016267, 29.557807928828282], ['NEO/USDT:USDT*binance&swap', 0.9880953825403628, 32.88605138455978], ['ADA/USDT:USDT*binance&swap', 0.9879357864952676, 34.3235172296568], ['HBAR/USDT:USDT*binance&swap', 0.9878426024723682, 32.93396427123588], ['NKN/USDT:USDT*binance&swap', 0.9876788049097465, 42.19982193310942], ['CAKE/USDT:USDT*binance&swap', 0.9876708429976083, 35.58760040412598], ['BSV/USDT:USDT*binance&swap', 0.9876269141590961, 40.66688293234478], ['RVN/USDT:USDT*binance&swap', 0.9875102027421452, 32.98279350475866], ['DYDX/USDT:USDT*binance&swap', 0.9874698207317475, 37.004649737199884], ['KAVA/USDT:USDT*binance&swap', 0.9874489081825072, 32.929082580548624], ['TRU/USDT:USDT*binance&swap', 0.9873559429464104, 36.04999109164433], ['CHR/USDT:USDT*binance&swap', 0.9873058165469604, 37.79742094070352], ['ATOM/USDT:USDT*binance&swap', 0.9871374827312234, 29.37661527429492], ['AAVE/USDT:USDT*binance&swap', 0.987129026683955, 37.81563720087216], ['C98/USDT:USDT*binance&swap', 0.9868433481096192, 34.99981009908413], ['SPELL/USDT:USDT*binance&swap', 0.9868116064617913, 42.00762231183289], ['COTI/USDT:USDT*binance&swap', 0.9867847787560493, 50.68482599566062], ['PEOPLE/USDT:USDT*binance&swap', 0.9865133875008045, 45.453498577930176], ['FIL/USDT:USDT*binance&swap', 0.9864549743511838, 36.31182086738137], ['ILV/USDT:USDT*binance&swap', 0.9864466854670211, 37.763955186129195], ['METIS/USDT:USDT*binance&swap', 0.986379576756694, 36.62046614304077], ['XEM/USDT:USDT*binance&swap', 0.9862683528211537, 30.768266086196192], ['BNB/USDT:USDT*binance&swap', 0.9861597073312977, 27.2484577003881], ['DGB/USDT:USDT*binance&swap', 0.9859963352810619, 29.695158549894757], ['ONE/USDT:USDT*binance&swap', 0.9858104441780985, 40.81654642860285], ['IOTA/USDT:USDT*binance&swap', 0.9855691506503489, 33.74185791229786], ['GMX/USDT:USDT*binance&swap', 0.9854926741155059, 31.95285277346639], ['SUPER/USDT:USDT*binance&swap', 0.9852532120477366, 41.682305567075105], ['SLP/USDT:USDT*binance&swap', 0.9851690263985005, 37.235083495186615], ['CELR/USDT:USDT*binance&swap', 0.9849640049705431, 36.143159649424334], ['GMT/USDT:USDT*binance&swap', 0.9849110989126318, 37.94136220031436], ['ETC/USDT:USDT*binance&swap', 0.984677334723419, 34.78232937910414], ['OMG/USDT:USDT*binance&swap', 0.9846157426447405, 39.272666239158], ['MANA/USDT:USDT*binance&swap', 0.9845915042777909, 38.291957933928245], ['OXT/USDT:USDT*binance&swap', 0.9844670263504202, 33.12659277919214], ['DAR/USDT:USDT*binance&swap', 0.9843682500674835, 41.50388993110441], ['STORJ/USDT:USDT*binance&swap', 0.984291474963464, 37.06212515126225], ['GAS/USDT:USDT*binance&swap', 0.9842376121986293, 33.00718249470472], ['IOST/USDT:USDT*binance&swap', 0.9841459415327616, 34.37124154460693], ['USTC/USDT:USDT*binance&swap', 0.9840774725999856, 40.28162577376622], ['THETA/USDT:USDT*binance&swap', 0.9837397062388341, 38.692177617573094], ['TWT/USDT:USDT*binance&swap', 0.9835293837753686, 36.418358986628476], ['MANTA/USDT:USDT*binance&swap', 0.9833209857774657, 47.828681098938716], ['SNT/USDT:USDT*binance&swap', 0.9831072905451906, 30.111892487885115], ['MOVR/USDT:USDT*binance&swap', 0.983102790312048, 39.74975871585056], ['ACH/USDT:USDT*binance&swap', 0.9829622540057935, 40.28910866509844], ['ALT/USDT:USDT*binance&swap', 0.9829079825334545, 44.35933594623408], ['MEME/USDT:USDT*binance&swap', 0.9828862405428755, 44.9692156190179], ['YFI/USDT:USDT*binance&swap', 0.9826657873807129, 36.40084781835904], ['WAVES/USDT:USDT*binance&swap', 0.9824567035304527, 38.478717801480045], ['QTUM/USDT:USDT*binance&swap', 0.9824561750513054, 32.427705621337765], ['TIA/USDT:USDT*binance&swap', 0.9822827737041488, 55.772064853283766], ['FXS/USDT:USDT*binance&swap', 0.9820291757857743, 33.11017684762437], ['SXP/USDT:USDT*binance&swap', 0.9820177150637385, 38.70949495838556], ['CELO/USDT:USDT*binance&swap', 0.9819681267027851, 34.44510246805709], ['CVX/USDT:USDT*binance&swap', 0.981637280531462, 34.18198610215029], ['WAXP/USDT:USDT*binance&swap', 0.9815754724651251, 30.010670413360884], ['IMX/USDT:USDT*binance&swap', 0.9815104991155208, 35.69115987672595], ['NEAR/USDT:USDT*binance&swap', 0.981171506241356, 48.803146411880604], ['XTZ/USDT:USDT*binance&swap', 0.981125388169136, 28.3573154634484], ['PORTAL/USDT:USDT*binance&swap', 0.9810589436699911, 48.37529600317495], ['APE/USDT:USDT*binance&swap', 0.9809805045832772, 38.63716109326644], ['ICP/USDT:USDT*binance&swap', 0.9809625711195002, 38.516273253140255], ['VET/USDT:USDT*binance&swap', 0.9808888731826074, 38.57808672681077], ['UNI/USDT:USDT*binance&swap', 0.9804093506734111, 38.37819917443707], ['BAT/USDT:USDT*binance&swap', 0.980090818117295, 31.14128249235233], ['ASTR/USDT:USDT*binance&swap', 0.9797594902516484, 31.54884358129027], ['SAND/USDT:USDT*binance&swap', 0.9797369155746322, 35.82596584991283], ['LINA/USDT:USDT*binance&swap', 0.9793358388423351, 37.57614930255171], ['DOGE/USDT:USDT*binance&swap', 0.978923023747638, 50.522241082668046], ['DYM/USDT:USDT*binance&swap', 0.9786435765906446, 34.49276810746376], ['GLMR/USDT:USDT*binance&swap', 0.9781276036363725, 37.31367241298672], ['ZEC/USDT:USDT*binance&swap', 0.9778358819138914, 33.824187219366934], ['BLUR/USDT:USDT*binance&swap', 0.9777697811954777, 33.80036050909936], ['HOT/USDT:USDT*binance&swap', 0.9776942113499059, 36.702435889617846], ['ROSE/USDT:USDT*binance&swap', 0.9770845792672708, 41.229944943360124], ['XAI/USDT:USDT*binance&swap', 0.9770618840147541, 42.42278941555581], ['ENS/USDT:USDT*binance&swap', 0.9769583762244359, 39.12079150777893], ['EOS/USDT:USDT*binance&swap', 0.9766459649808199, 30.27356196662592], ['1INCH/USDT:USDT*binance&swap', 0.9762491236420953, 32.23445894426828], ['LTC/USDT:USDT*binance&swap', 0.9762275565224598, 28.229391998297018], ['ORDI/USDT:USDT*binance&swap', 0.976198511810325, 45.99613216498753], ['GLM/USDT:USDT*binance&swap', 0.9761300667087028, 38.24935051050633], ['XLM/USDT:USDT*binance&swap', 0.9760638467573045, 25.569403021194944], ['MASK/USDT:USDT*binance&swap', 0.9746871727596542, 36.001894771890946], ['JASMY/USDT:USDT*binance&swap', 0.9746420509628327, 40.807607123114565], ['SSV/USDT:USDT*binance&swap', 0.974417404831645, 48.258490265492696], ['WLD/USDT:USDT*binance&swap', 0.974400733686685, 60.34099858490029], ['STRK/USDT:USDT*binance&swap', 0.9740679601285389, 42.981835699863495], ['GAL/USDT:USDT*binance&swap', 0.9735306625880802, 38.7587276873914], ['HFT/USDT:USDT*binance&swap', 0.973022769740045, 43.29825364016642], ['LRC/USDT:USDT*binance&swap', 0.9729094594365028, 50.0051009406627], ['ETH/USDT:USDT*binance&swap', 0.9715188470307937, 26.58989714828587], ['JUP/USDT:USDT*binance&swap', 0.9714543712304766, 62.47703690357916], ['SOL/USDT:USDT*binance&swap', 0.9704625708086358, 41.03028969972142], ['SUI/USDT:USDT*binance&swap', 0.970290544640391, 33.72695463231085], ['XRP/USDT:USDT*binance&swap', 0.9699012621236922, 24.234937417620117], ['RUNE/USDT:USDT*binance&swap', 0.9694966125052251, 41.79659939735865], ['RAD/USDT:USDT*binance&swap', 0.9676905174725429, 36.465227141866535], ['SEI/USDT:USDT*binance&swap', 0.9675794270333076, 35.413855035239635], ['PYTH/USDT:USDT*binance&swap', 0.9667284916187553, 42.50298249366834], ['ZIL/USDT:USDT*binance&swap', 0.9664603915720082, 40.87056682788321], ['AVAX/USDT:USDT*binance&swap', 0.9664389581429099, 41.99909593510088], ['RLC/USDT:USDT*binance&swap', 0.9658849974775038, 44.65445509467115], ['GRT/USDT:USDT*binance&swap', 0.9658536905986994, 34.397543175595914], ['BCH/USDT:USDT*binance&swap', 0.9651305730449692, 32.190413225739576], ['LDO/USDT:USDT*binance&swap', 0.9649001371412755, 42.88499545476711], ['ETHFI/USDT:USDT*binance&swap', 0.9637762320501805, 56.820043193007336], ['TRX/USDT:USDT*binance&swap', 0.9629095774139159, 23.794950227539786], ['API3/USDT:USDT*binance&swap', 0.9622086659075147, 42.571029489647245], ['BTC/USDT:USDT*binance&swap', 0.9595754999285125, 24.280479888471575], ['ETHW/USDT:USDT*binance&swap', 0.9591334026969118, 30.38528096161366], ['PENDLE/USDT:USDT*binance&swap', 0.9550006892078955, 40.36281465251747], ['CKB/USDT:USDT*binance&swap', 0.9538166667988258, 44.83847626080771], ['CRV/USDT:USDT*binance&swap', 0.953576950903642, 45.132458988531], ['SKL/USDT:USDT*binance&swap', 0.9488880864022075, 77.96225000382337], ['ZETA/USDT:USDT*binance&swap', 0.9487477416225573, 41.69178497066781], ['ARB/USDT:USDT*binance&swap', 0.9467726737656107, 45.5717556525577], ['INJ/USDT:USDT*binance&swap', 0.9464818718452882, 44.019601521238044], ['AEVO/USDT:USDT*binance&swap', 0.9451646642393142, 59.55484985952111], ['MATIC/USDT:USDT*binance&swap', 0.9302119809847145, 30.901783921079527], ['PIXEL/USDT:USDT*binance&swap', 0.928679215324097, 62.9707360715625], ['JTO/USDT:USDT*binance&swap', 0.9261625124486201, 59.35676770593568], ['CFX/USDT:USDT*binance&swap', 0.924067405383269, 55.925236364855934], ['XMR/USDT:USDT*binance&swap', 0.9240255336554026, 28.34747914412091], ['RNDR/USDT:USDT*binance&swap', 0.9059185125912889, 54.02029126461696], ['OP/USDT:USDT*binance&swap', 0.9058234478125039, 62.806299028368], ['OCEAN/USDT:USDT*binance&swap', 0.9038390843089024, 58.45597200968122], ['STX/USDT:USDT*binance&swap', 0.883414663290494, 54.78664315777277], ['WIF/USDT:USDT*binance&swap', 0.8692002267752464, 106.46925846714447], ['GALA/USDT:USDT*binance&swap', 0.8561005593346298, 54.70887506944214], ['ZRX/USDT:USDT*binance&swap', 0.849848675851382, 60.843157324152], ['CYBER/USDT:USDT*binance&swap', 0.8484592785173886, 42.27785618084776], ['FTM/USDT:USDT*binance&swap', 0.8314859128392411, 73.13584386976348], ['ID/USDT:USDT*binance&swap', 0.8273583855150599, 47.698623781721835], ['BLZ/USDT:USDT*binance&swap', 0.8206836747786379, 28.53593313640644], ['MKR/USDT:USDT*binance&swap', 0.7851007857968144, 35.46767948637617], ['FRONT/USDT:USDT*binance&swap', 0.7721229449098668, 78.00905493517581], ['AGIX/USDT:USDT*binance&swap', 0.760960876911531, 58.43952349450947], ['TON/USDT:USDT*binance&swap', 0.742556248953692, 46.37269986388871], ['AR/USDT:USDT*binance&swap', 0.738917246595337, 59.8438238734754], ['APT/USDT:USDT*binance&swap', 0.6807829986514489, 48.35688277646008], ['FET/USDT:USDT*binance&swap', 0.557570353524973, 65.45859882220927], ['MTL/USDT:USDT*binance&swap', 0.4938234698264374, 47.64889604624892], ['BOME/USDT:USDT*binance&swap', 0.15161124989712624, 105.27757539936279], ['USDC/USDT:USDT*binance&swap', -0.047382672695407003, 0.08301863578043367]]
# YGG/USDT:USDT*binance&swap [['YGG/USDT:USDT*binance&swap', 1.0, 100.85195830404675], ['LOOM/USDT:USDT*binance&swap', 0.9932587120572136, 77.09327102635834], ['OGN/USDT:USDT*binance&swap', 0.9931192393770711, 91.16374826680551], ['RSR/USDT:USDT*binance&swap', 0.9928922365319418, 89.59257968695923], ['BAND/USDT:USDT*binance&swap', 0.9926726316605744, 74.34958823470848], ['BNT/USDT:USDT*binance&swap', 0.9924938191408947, 57.21109471407111], ['BICO/USDT:USDT*binance&swap', 0.9924443386703745, 82.5221554514963], ['REN/USDT:USDT*binance&swap', 0.9921983159257033, 90.07168120803979], ['ORBS/USDT:USDT*binance&swap', 0.9920585594903956, 80.61088458412004], ['REEF/USDT:USDT*binance&swap', 0.9919808704226525, 91.30979894435995], ['ALPHA/USDT:USDT*binance&swap', 0.9919386271793228, 75.16851941149262], ['STG/USDT:USDT*binance&swap', 0.991932942066816, 60.07189682709611], ['FLOW/USDT:USDT*binance&swap', 0.9918707951622897, 79.62814272930514], ['BAL/USDT:USDT*binance&swap', 0.9918593012430894, 56.618796264992326], ['ALGO/USDT:USDT*binance&swap', 0.9917035930565593, 84.12649559312018], ['LPT/USDT:USDT*binance&swap', 0.9915845168235081, 113.24255602666054], ['AXS/USDT:USDT*binance&swap', 0.9915817702840125, 96.18560084371705], ['SUSHI/USDT:USDT*binance&swap', 0.9915481358177143, 94.02478572923481], ['AUDIO/USDT:USDT*binance&swap', 0.991301529494288, 82.81235257674872], ['UMA/USDT:USDT*binance&swap', 0.9911798912917088, 106.9350087071363], ['AGLD/USDT:USDT*binance&swap', 0.9911485650430427, 85.52651098416301], ['ENJ/USDT:USDT*binance&swap', 0.9910223940813271, 94.42015053497357], ['NMR/USDT:USDT*binance&swap', 0.9910105421045394, 83.92805136146617], ['ACE/USDT:USDT*binance&swap', 0.9909964889196633, 106.95924349478564], ['KSM/USDT:USDT*binance&swap', 0.9909317528901098, 99.30262567000258], ['DASH/USDT:USDT*binance&swap', 0.9908865130627194, 79.26188339189217], ['LSK/USDT:USDT*binance&swap', 0.9905934071802577, 83.00578502637066], ['RDNT/USDT:USDT*binance&swap', 0.9905821458979444, 84.27036819399348], ['MINA/USDT:USDT*binance&swap', 0.990451849000478, 86.62268885134142], ['KLAY/USDT:USDT*binance&swap', 0.9903884986677666, 72.72106069379703], ['TLM/USDT:USDT*binance&swap', 0.9903267384395583, 97.07277196496673], ['ALICE/USDT:USDT*binance&swap', 0.9902318097473611, 95.02074787637912], ['LINK/USDT:USDT*binance&swap', 0.9902251874750879, 89.5893375569677], ['WOO/USDT:USDT*binance&swap', 0.9901540614476155, 100.33381613700524], ['CTSI/USDT:USDT*binance&swap', 0.9900644627779213, 82.31508292520118], ['COMP/USDT:USDT*binance&swap', 0.9900406726130714, 87.72859643100543], ['IOTX/USDT:USDT*binance&swap', 0.9900226795913046, 86.73581478143427], ['CHZ/USDT:USDT*binance&swap', 0.9897306014150982, 77.03095315641255], ['BIGTIME/USDT:USDT*binance&swap', 0.989727101251549, 129.25479582563412], ['DOT/USDT:USDT*binance&swap', 0.9897089243780748, 96.155847156784], ['AUCTION/USDT:USDT*binance&swap', 0.9894191274130667, 85.62298644217788], ['MDT/USDT:USDT*binance&swap', 0.9893571491671899, 88.36509652659878], ['ANKR/USDT:USDT*binance&swap', 0.9893559232001595, 89.52061545572252], ['ICX/USDT:USDT*binance&swap', 0.9891283753667559, 79.02760339095794], ['ARPA/USDT:USDT*binance&swap', 0.9890819338246891, 83.53518182622292], ['KNC/USDT:USDT*binance&swap', 0.9889347779675436, 76.78069935669606], ['MAGIC/USDT:USDT*binance&swap', 0.9889317656702392, 91.04836119569602], ['SNX/USDT:USDT*binance&swap', 0.9888909809399538, 76.59340169627015], ['EGLD/USDT:USDT*binance&swap', 0.9888054201389977, 94.78234806351234], ['TRB/USDT:USDT*binance&swap', 0.9887727715106933, 97.91505824146492], ['ONT/USDT:USDT*binance&swap', 0.9887631829876526, 76.41897334134529], ['T/USDT:USDT*binance&swap', 0.9886843506555552, 67.66661904077347], ['POWR/USDT:USDT*binance&swap', 0.9885779610336641, 80.65014789259291], ['PERP/USDT:USDT*binance&swap', 0.9885614659282707, 85.39796567941359], ['QNT/USDT:USDT*binance&swap', 0.9884033099676369, 64.4770975148098], ['NEO/USDT:USDT*binance&swap', 0.9880772893491268, 79.58660706649522], ['ADA/USDT:USDT*binance&swap', 0.9880060105640457, 91.79194524747575], ['HBAR/USDT:USDT*binance&swap', 0.9879987729531269, 71.84801768412456], ['BSV/USDT:USDT*binance&swap', 0.9877038474300367, 107.55274612419885], ['CAKE/USDT:USDT*binance&swap', 0.9876867844581448, 97.4223229897354], ['KAVA/USDT:USDT*binance&swap', 0.9875188775318041, 84.22528873656631], ['DYDX/USDT:USDT*binance&swap', 0.9874384458330645, 88.87441518079703], ['NKN/USDT:USDT*binance&swap', 0.9874206252078044, 96.9184187996509], ['TRU/USDT:USDT*binance&swap', 0.9874170038676885, 67.1718430726581], ['RVN/USDT:USDT*binance&swap', 0.9873797109416438, 67.4937473263401], ['CHR/USDT:USDT*binance&swap', 0.987327362735082, 87.73328231069499], ['ATOM/USDT:USDT*binance&swap', 0.9871826357101766, 74.89987251553248], ['AAVE/USDT:USDT*binance&swap', 0.9870957361628572, 102.68629103841535], ['C98/USDT:USDT*binance&swap', 0.9867923975113193, 76.85708935244097], ['COTI/USDT:USDT*binance&swap', 0.9867613523925918, 128.00766653509675], ['SPELL/USDT:USDT*binance&swap', 0.986686253011469, 103.27569308761308], ['METIS/USDT:USDT*binance&swap', 0.9865426849140215, 77.30987296864186], ['PEOPLE/USDT:USDT*binance&swap', 0.9865214010512579, 117.12031724995849], ['FIL/USDT:USDT*binance&swap', 0.9864484987780555, 96.6743282832892], ['ILV/USDT:USDT*binance&swap', 0.9864232706918963, 76.43912804804494], ['BNB/USDT:USDT*binance&swap', 0.9863361764771509, 80.01988723874653], ['XEM/USDT:USDT*binance&swap', 0.9861859091581525, 48.14881334099381], ['DGB/USDT:USDT*binance&swap', 0.98598054993753, 48.52047126454906], ['IOTA/USDT:USDT*binance&swap', 0.9856802308042493, 82.59725634781347], ['GMX/USDT:USDT*binance&swap', 0.9856795277944698, 77.99915470948861], ['ONE/USDT:USDT*binance&swap', 0.9856670218554142, 99.56875430774859], ['SUPER/USDT:USDT*binance&swap', 0.9851626894249784, 95.3827788353666], ['GMT/USDT:USDT*binance&swap', 0.9849792346121162, 94.72100792580991], ['SLP/USDT:USDT*binance&swap', 0.984910380358818, 99.5108754222781], ['CELR/USDT:USDT*binance&swap', 0.9848844652198905, 83.48346254113592], ['OMG/USDT:USDT*binance&swap', 0.984710736888107, 98.2522528691283], ['ETC/USDT:USDT*binance&swap', 0.9846673635892156, 102.45922847115875], ['MANA/USDT:USDT*binance&swap', 0.9846666426943966, 103.8018326460159], ['OXT/USDT:USDT*binance&swap', 0.984561192450698, 74.16359775069994], ['STORJ/USDT:USDT*binance&swap', 0.9843435845553412, 107.40579078116824], ['GAS/USDT:USDT*binance&swap', 0.9842998124271064, 84.52806431864158], ['DAR/USDT:USDT*binance&swap', 0.9842353581478676, 86.67579919025921], ['USTC/USDT:USDT*binance&swap', 0.9841307991560391, 89.07235466640887], ['IOST/USDT:USDT*binance&swap', 0.9840441749128205, 88.72458061440588], ['THETA/USDT:USDT*binance&swap', 0.9838600839253778, 104.02402826627298], ['TWT/USDT:USDT*binance&swap', 0.9836234987762361, 79.0303164403704], ['MANTA/USDT:USDT*binance&swap', 0.9834963526153404, 136.58639267150292], ['MOVR/USDT:USDT*binance&swap', 0.9831578705218434, 91.02946194060758], ['ACH/USDT:USDT*binance&swap', 0.9830800249394015, 96.24843859283959], ['SNT/USDT:USDT*binance&swap', 0.9830790923985527, 66.94153088750036], ['ALT/USDT:USDT*binance&swap', 0.9828972876911236, 108.00924631221561], ['MEME/USDT:USDT*binance&swap', 0.9827977018246478, 122.47275654360173], ['YFI/USDT:USDT*binance&swap', 0.9826080163093535, 87.11636649072034], ['QTUM/USDT:USDT*binance&swap', 0.9824650833374129, 81.15898497798801], ['WAVES/USDT:USDT*binance&swap', 0.9823989003201243, 103.47523561956335], ['TIA/USDT:USDT*binance&swap', 0.9822717617941309, 150.83461945547845], ['FXS/USDT:USDT*binance&swap', 0.9820866418677132, 76.43041260927801], ['CELO/USDT:USDT*binance&swap', 0.9820281730315222, 65.21982516492821], ['SXP/USDT:USDT*binance&swap', 0.9819331651072721, 96.31940060067654], ['IMX/USDT:USDT*binance&swap', 0.9817560198960966, 85.83774089219932], ['CVX/USDT:USDT*binance&swap', 0.9817464910062086, 82.8608577798613], ['WAXP/USDT:USDT*binance&swap', 0.9815915100262596, 74.80131009328787], ['NEAR/USDT:USDT*binance&swap', 0.9811419107866514, 136.42876356042694], ['PORTAL/USDT:USDT*binance&swap', 0.9811286396797069, 102.73757708272163], ['ICP/USDT:USDT*binance&swap', 0.9810116450215766, 97.97574204075725], ['VET/USDT:USDT*binance&swap', 0.980955187494599, 94.56926381121474], ['APE/USDT:USDT*binance&swap', 0.9809301859207556, 102.72968710780181], ['XTZ/USDT:USDT*binance&swap', 0.9808178255294502, 58.097914608040895], ['UNI/USDT:USDT*binance&swap', 0.980433026538076, 96.35005969068598], ['BAT/USDT:USDT*binance&swap', 0.98030551732388, 65.12029131832762], ['ASTR/USDT:USDT*binance&swap', 0.9800440309157404, 63.32110998647775], ['SAND/USDT:USDT*binance&swap', 0.9797910587966582, 97.19243417861871], ['LINA/USDT:USDT*binance&swap', 0.9792633898094885, 88.11259084139998], ['DOGE/USDT:USDT*binance&swap', 0.9791298842319023, 139.61889596494143], ['DYM/USDT:USDT*binance&swap', 0.9787700043034694, 81.93545266229079], ['GLMR/USDT:USDT*binance&swap', 0.9780571699489737, 96.62222800977186], ['ZEC/USDT:USDT*binance&swap', 0.9779679664142599, 64.32844844145157], ['BLUR/USDT:USDT*binance&swap', 0.9776903981814886, 88.67298936828612], ['HOT/USDT:USDT*binance&swap', 0.9776101251733307, 92.13193835515003], ['ENS/USDT:USDT*binance&swap', 0.9771498696313606, 103.03512812691912], ['ROSE/USDT:USDT*binance&swap', 0.9771075603138202, 97.71874590502597], ['XAI/USDT:USDT*binance&swap', 0.9769184164452499, 114.2237300378781], ['EOS/USDT:USDT*binance&swap', 0.9767764415939276, 68.1155144249087], ['ORDI/USDT:USDT*binance&swap', 0.9764588451841603, 128.18719715536082], ['LTC/USDT:USDT*binance&swap', 0.9763576732250105, 67.54578094240881], ['1INCH/USDT:USDT*binance&swap', 0.97624680409907, 80.40838380031627], ['XLM/USDT:USDT*binance&swap', 0.9761234187373083, 64.62010987888405], ['GLM/USDT:USDT*binance&swap', 0.97590717285193, 91.32634019434872], ['MASK/USDT:USDT*binance&swap', 0.9748773172601217, 95.0333416650745], ['JASMY/USDT:USDT*binance&swap', 0.9747873372718112, 99.6940845518615], ['SSV/USDT:USDT*binance&swap', 0.9746487667066916, 116.08415512340082], ['WLD/USDT:USDT*binance&swap', 0.9744252388810503, 159.9531455125247], ['STRK/USDT:USDT*binance&swap', 0.9738935037967807, 113.83321913190196], ['GAL/USDT:USDT*binance&swap', 0.9737240743159056, 94.82178111550934], ['HFT/USDT:USDT*binance&swap', 0.9731341310451707, 107.66320195356838], ['LRC/USDT:USDT*binance&swap', 0.9728764449141338, 127.36682174812337], ['ETH/USDT:USDT*binance&swap', 0.9719080245122637, 72.52641118457638], ['JUP/USDT:USDT*binance&swap', 0.9718032845409871, 177.1998040100371], ['SOL/USDT:USDT*binance&swap', 0.9703165868325119, 120.70013152161839], ['SUI/USDT:USDT*binance&swap', 0.9699827724837368, 89.85076525450148], ['XRP/USDT:USDT*binance&swap', 0.9698836640052887, 56.88832678030714], ['RUNE/USDT:USDT*binance&swap', 0.9696234760020854, 102.57355355439483], ['SEI/USDT:USDT*binance&swap', 0.9677474350354832, 93.41459727563421], ['RAD/USDT:USDT*binance&swap', 0.9677423540103465, 70.80283684067203], ['PYTH/USDT:USDT*binance&swap', 0.9670394562298948, 89.08113208855279], ['AVAX/USDT:USDT*binance&swap', 0.966551000070762, 116.71988699841583], ['ZIL/USDT:USDT*binance&swap', 0.9664043862305606, 112.68826324606158], ['RLC/USDT:USDT*binance&swap', 0.965889798151486, 112.43915315179827], ['GRT/USDT:USDT*binance&swap', 0.9658810089985542, 95.26823476851665], ['BCH/USDT:USDT*binance&swap', 0.9649973894361893, 88.41197006617782], ['LDO/USDT:USDT*binance&swap', 0.9648044959104419, 110.27179639546182], ['ETHFI/USDT:USDT*binance&swap', 0.9640223736197652, 121.25481108422596], ['TRX/USDT:USDT*binance&swap', 0.9630844999538014, 48.813045909721396], ['API3/USDT:USDT*binance&swap', 0.9624758141215837, 105.3700809774469], ['BTC/USDT:USDT*binance&swap', 0.9598098173692804, 63.431403793144455], ['ETHW/USDT:USDT*binance&swap', 0.9592417233275923, 61.116361756041016], ['PENDLE/USDT:USDT*binance&swap', 0.9550665270506329, 103.37118267483717], ['CRV/USDT:USDT*binance&swap', 0.9546022390021113, 109.47021967430936], ['CKB/USDT:USDT*binance&swap', 0.95370542445269, 115.41355507588517], ['SKL/USDT:USDT*binance&swap', 0.9491061585585995, 199.9238912646004], ['ZETA/USDT:USDT*binance&swap', 0.9488213824303907, 86.73481337555123], ['ARB/USDT:USDT*binance&swap', 0.9467929608796928, 125.82834013623264], ['INJ/USDT:USDT*binance&swap', 0.946555263190444, 114.62652503398685], ['AEVO/USDT:USDT*binance&swap', 0.9458536089927342, 123.44424527363975], ['MATIC/USDT:USDT*binance&swap', 0.9300856576239935, 78.22470487516844], ['PIXEL/USDT:USDT*binance&swap', 0.9279634868838026, 166.12466368556085], ['JTO/USDT:USDT*binance&swap', 0.9255465928036843, 158.10717084465352], ['CFX/USDT:USDT*binance&swap', 0.9244111461321831, 127.05121690746718], ['XMR/USDT:USDT*binance&swap', 0.9237578704579447, 62.06422127988537], ['RNDR/USDT:USDT*binance&swap', 0.9061873594283127, 146.79758745621504], ['OP/USDT:USDT*binance&swap', 0.9057719973395253, 165.88861858931548], ['OCEAN/USDT:USDT*binance&swap', 0.9033058861964721, 148.52530154672053], ['STX/USDT:USDT*binance&swap', 0.8838688792005122, 142.67416402526962], ['WIF/USDT:USDT*binance&swap', 0.8692976445624739, 289.59647726580795], ['GALA/USDT:USDT*binance&swap', 0.8563885986366668, 153.56365998187047], ['ZRX/USDT:USDT*binance&swap', 0.8510898240683641, 149.24599017534555], ['CYBER/USDT:USDT*binance&swap', 0.848394796095604, 94.62357093641829], ['FTM/USDT:USDT*binance&swap', 0.8303269533268804, 206.68600417090292], ['ID/USDT:USDT*binance&swap', 0.8284219066125581, 104.09711498829796], ['BLZ/USDT:USDT*binance&swap', 0.8197413597886735, 61.585834394193256], ['MKR/USDT:USDT*binance&swap', 0.7854296253023095, 85.08618235273255], ['FRONT/USDT:USDT*binance&swap', 0.7720706738851411, 194.12926990415605], ['AGIX/USDT:USDT*binance&swap', 0.7591200318241397, 157.23913397252105], ['TON/USDT:USDT*binance&swap', 0.7414865884577945, 112.61315297314665], ['AR/USDT:USDT*binance&swap', 0.739265816023525, 148.42526201209836], ['APT/USDT:USDT*binance&swap', 0.6799045817968545, 135.13595884106596], ['FET/USDT:USDT*binance&swap', 0.5537559641553199, 176.34905080158222], ['MTL/USDT:USDT*binance&swap', 0.4935183985122073, 114.41450925935044], ['BOME/USDT:USDT*binance&swap', 0.14976783999423468, 321.7532772773952], ['USDC/USDT:USDT*binance&swap', -0.046471760677450784, 0.09842209350358644]]


timer=time.time()
kolonki=list(cordat2)
# print(kolonki)
df = pd.DataFrame(cordat2, columns=kolonki)
z= df.corr()
a=z.to_dict()

# quit()
# z.to_csv("output.csv",sep=';', index=False)
# cordatsum[inst]
print('выведу кореляции в итог')
rezcor=dict()
for key in a:
	rezcor[key]=[]
	srt=mysortdict(a[key])
	for ky in srt:
		rezcor[key].append([ky,round( srt[ky],6),round(cordatsum[ky],1)])

f = open("foo.txt", "w")
for key in rezcor:
	f.write(str([key,rezcor[key]])+"\n")
f.close()


# quit()

#
# color = get_color()
# fig = px.line(title=' без резки - аск/бид')
# for  inst in rezdict:
# 	clr = color()
# 	fig.add_scatter(x=ixes, y=rezdict [inst]['asks'], line_color=clr, name= inst + ' ask')
# 	fig.add_scatter(x=ixes, y=rezdict[inst]['bids'], line_color=clr, name= inst+ ' bid')
# fig.show()

# color = get_color()
# fig = px.line(title='графип по которому строилась матрица кореляцй без резки ')
# for  inst in cordat:
# 	clr = color()
# 	fig.add_scatter(x=ixes, y=cordat [inst], line_color=clr, name= inst + ' ask')
# fig.show()

# quit()
color = get_color()
fig = px.line(title='графип по которому строилась матрица кореляцй с резкой ')
for  inst in cordat2:
	clr = color()
	fig.add_scatter(x=ixes2, y=cordat2 [inst], line_color=clr, name= inst + ' ask')
fig.show()