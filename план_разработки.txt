Предварительный план и идеи.
Блоки:


Файл кодов площадок и их комиссий
СБОРЩИК
ФИЛЬТРОВЩИК СБОРА
ПРЕОБРАЗОВАТЕЛЬ в минутки
ВИЗУАЛИЗАТОРЫ котировок
ОПТИМИЗАТОР.
ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТА ОПТИМИЗАЦИИ

Файл кодов площадок и их комиссий
Пишется вручную. 
Формат   -  (название площадки полное, код площадки, комиссия в проц за объем сделки,  комиссия в валюте за 1 контракт, за факт сделки (ну ее нах тогда) ). Все пересчитывать в бакс.
Нужен,  чтобы идентифицировать инструменты с одинаковым тикером , но из разных рынков и ранжировать по комиссиям. Вгоняется в словарь  для последующего учета при тестировании и оптимизации.

СБОРЩИК перепарсить данные из  бинарных файлов mql5
Файловая бд. Папки  :Сборщик / год/ месяц/число/ час-название файла
Цены собираются не менее чем раз в секунду  по каждому инструменту, но  при условии что изменилась хотя бы  одна из лучших цен, либо хотя бы один из ближайших объемов стакана.  
СТРУКТУРА ЗАПИСИ ДАННЫХ
1)	«*» - антисбойный знак проверки перед каждым циклом сбора  + Время в сек Юникс
2)
3)	Код площадки  
4)	Название инструмента
5)	тип  сбора.
    s   сбор стаканов.  |   к-во эл-тов,    (цена, объем)  -  изнутри наружу сперва аски, потом то же самое для бидов
    a   сбор АСК+БИД
    l   сбор одного параметра исключительно индикативно – LAST или (ask+bid)/2


6)  цифра указывающая на количество дополнительных данных  0 - нет доп данных 
параметры идут в списке по порядку
    0-Last
    1-проторгованный объем за период между записями
    2-общий абъем  Buyvolumes
    3-объем Sellvolumes
    4-к-во ордеров Buyorders
    5-кво ордеров Sellorders
    6- открытый интерес

// ждсон - в итоговом для работы на пайтон

p- площадка
i-инструмент
l-Last
a- ask
b-bid
vl-проторгованный объем за период между записями
bvl-общий абъем  Buyvolumes -биды
avl-объем Sellvolumes -аски
kbo-кво ордеров Buyorders - т.е биды
kao-кво ордеров Sellorders те аски
itr- открытый интерес

asks - кортеж асков ((цена,объем),(цена,объем),...)
bids - кортеж бидов ((цена,объем),(цена,объем),...)




ФИЛЬТРОВЩИК СБОРА
  Выявить инструменты, которые не изменялись в течении дня (для выявления  сбоя поставки котировок). И которые изменялись. Автопуск раз в день. 
Эти списки инструментов  сохранять в файл в ту же директорию что и сборщик   Сборщик / год/ месяц/число/ название файла – INFO.    Для определения динамики - какие инструменты добавились, какие ушли – использовать операции со структурой данных «множество».

ПРЕОБРАЗОВАТЕЛЬ в минутки
Папки  : Сборщик / год/ месяц/число/  название файла – TIMEFRAMES
индикативная вещь.  С целю более масштабного визуала и повышения  скорости расчета корреляций.  Делает нарезки не по классике (OHLC) а только аск/бид через заданные интервалы 1 минута, 15мин , час. Все формируются на основе минуток. Желательно  начальная фаза 30 секунд, а не начало минуты, чтобы исключить попадания на расширение спреда при клиринге в случае фьючерсов.

ВИЗУАЛИЗАТОРЫ котировок
1)	Вывод отдельно графика аск/бид либо баров по любому запрашиваемому инструменту
2)	Вывод всех графиков в одно окно с одинаковой стартовой точкой. 
3)	Организовать вывод индикаторов- фильтров
Графики сделать прокручиваемыми влево/вправо.  Можно просто перелистывание постранично.
Дополнительно – 
Динамика стаканов в Экель – было реализовано на MQL. Переписать на пайтон.
Сортировка и классификация по взаимной скоррелированности.  
Матрица корреляций
Рейтинг корреляций – Топ с больше 0,7 по количеству
Рейтинг ведомых и ведущих.
итд


ОПТИМИЗАТОР.
Файл закачивается в оперативку – в Словарь . Ключ – название инструмента + код площадки. 
Мультипроцессинг. Распараллелить прогоны по истории для каждого сочетания параметров. 
Результаты выводить в файл (  Папка – Результат, имя файла – юникс время). В структуре -
Значения  параметров,  инструмент, направление сделки, объем тестовый, макс объем кот позволяет рынок (Об входа+ об выхода)/2,  время входа в сделку, время выхода из сделки, цена входа, макс эквити, мин эквити, цена выхода.  

Незавершенные сделки указываем  в конце в любом случае (открытие, хай, лоу) 
Выбор объема входа в оптимизаторе. 
1-	Сотня.  Результат будет эквивалентен кумулятивному проценту. Чисто индикативно.
2-	Медианный по стакану, но не больше среднего бестбанда входа и выхода 
3-	Пунк 2 + еще одно ограничение - Уравновешенный в зависимости от волатильности. Выше волатильность – ниже объем. Предварительно требуется ранжировать все торгуемые инструменты по воле для расчета весовых кэфов.
Основная работа ведется с результатами оптимизации. 

ВИЗУАЛИЗАЦИЯ РЕЗУЛЬТАТА ОПТИМИЗАЦИИ
Вшить в общий визуализатор.  Рисуем графики эквити из одной точки. фильтруем. – 10% лучших и 10% худших


По и деям - 
Условия отбора алгоритмов. 
Примерные параметры (возможность настраивать на вкус свой)
1)	Вероятность того, что результат неслучайно закономерно положительный 99,99%  на основе расчета баров эквити и вывода плотности вероятности. 
2)	Матожидание прибыли – как минимум 3 комиссии. 
 Проверить на тестовом периоде. 

Гребаный вопрос – как максимально просто торговый робот обернуть в оптимизатор, чтобы не писать дважды.
Добавить параметр ТЕСТ. ИФ тест - вместо торговых функций ставим эмуляцию, вместо потоковых котировок льем из файла. 

ВЕДЕНИЕ УЧЕТА.
По каждому рынку –свой учет.   На основании которого делать общий отчет + интерактивный график эквити , перерисовывающийся при актуализации данных раз в 1-5 минут. Отчет - по реальным данным и по тестовым.  Т.е сравнение - как бот торгует реалтайм + как эмулирует торговлю по историческим данным на том же промежутке времени.  Всегда нужно вести проверку адекватности тестовой модели. 
Оценка влияния на рынок в контексте применяемой стратегии. 
Пускаем бот-эмулятор следом с задержкой за реальным.
Т.е предполагаем что следом пойдет аналогичный бот – смотрим потерю эффективности. На истории это сэмулировать можно, но адекватность модели будет оставлять лучшего, поэтому делаем только согласованно с роботом на реале.  А результат сравниваем с тем же ботом, но идущим на опережении.  Не с реальным. 
Метод позволяет лучше прощупать ликвидность рынка в контексте применяемой стратегии. 

ТОРГОВЫЙ БОТ.
Жесть жесткая.   
Главное – унифицировать все запросы, без уклона в специфику каждого рынка.


Стратегии.  
 Жестить не будем.  Сперва только экстра лайт.  Надеюсь поймать немного неэффективностей по хромому арбитражу и стаканной продавке.  Не забыть проверить календарные спреды.


 Архитектура.
 Синтаксис один, при тесте и ли при реале  - два разных параметра фунции.
Торговые функции ссылаются на подфункции для каждой из площадок, ибо запросы разные по структуре. Функции можно возвращать через ретурнЫ


начать с файла хеад., где будут лежать котиры. В проге задавать путь к файлу,

профит зигзаг - шаг зигзака -издержки при переходе через 0, меряем среднее откл от пиков

действующая версия на мт5 - полный шлак. 0 науки. Демка, написанная за 10 минут. странно что работает до сих пор. Но неэффективно.
- учесть комиссии по разным рынками пскать подстройку под рынок на лету, используя алгоритм прямого перебора

